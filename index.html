<!doctype html>
<html lang="nb">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="screen-orientation" content="landscape">
<title>Snake ‚Äì Gloser uke 45 (Kampen 6. trinn)</title>
<style>
:root{
  --bg:#0c1020;--panel:#151a2b;--ink:#eef3fb;--muted:#9fb1d1;
  --line:#223059;--good:#42d392;--bad:#ff6b6b;
}
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:#0c1020;color:var(--ink);
  font:16px system-ui,Segoe UI,Roboto,Arial;overflow:hidden}
header{text-align:center;background:#151a2b;border-bottom:1px solid var(--line);padding:8px 14px}
h1{margin:0;font-size:18px}.muted{color:var(--muted);font-size:14px}
.wrap{max-width:960px;margin:auto;padding:6px}
#canvasWrap{background:radial-gradient(1000px 480px at 30% -8%,#18234a,#0c1020 60%);
  border:1px solid var(--line);border-radius:12px;padding:6px;margin:auto}
canvas{display:block;width:100%;height:auto;background:#0a1020;
  border:1px solid #1b274b;border-radius:10px;touch-action:none}
#mobControls{display:grid;place-items:center;margin-top:8px}
#mobControls .row{display:flex;gap:14px;justify-content:center;margin-top:6px}
#mobControls button{width:70px;height:70px;font-size:30px;border-radius:14px;
  background:#1a274b;color:#fff;border:1px solid #223059;}
#mobControls button:active{transform:scale(.95)}
@media(min-width:900px){#mobControls{display:none}}
#ui{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:8px;text-align:center;margin-top:8px}
.chip{display:inline-flex;gap:6px;align-items:center;background:#1a2240;border:1px solid var(--line);
  border-radius:999px;padding:4px 10px;margin:2px 3px;font-size:15px}
button{appearance:none;background:#1b274b;color:var(--ink);border:1px solid var(--line);
  padding:8px 12px;border-radius:10px;font-weight:700;font-size:15px;cursor:pointer}
button:active{transform:translateY(1px)}
.btn-prim{background:#1b3b2e;border-color:#225a42}
#modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:50}
#card{width:min(92vw,460px);background:#0f1734;border:1px solid #2a3a68;border-radius:14px;
  padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.35);text-align:center}
#ans{width:100%;padding:12px 14px;font-size:18px;border-radius:10px;
  border:1px solid #2a3a68;background:#101833;color:#fff}
.row{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;justify-content:center}
.good{color:var(--good)}.bad{color:var(--bad)}
#hint{display:none;margin-top:8px;color:var(--muted);font-style:italic}
#fasitWrap{text-align:center;margin-top:12px}
table{width:100%;border-collapse:collapse;font-size:15px;margin-top:6px}
th,td{border:1px solid #2a3a68;padding:6px 8px;text-align:left}
th{background:#1a2240}
</style>
</head>
<body>
<header>
  <h1>Snake ‚Äì Gloser ‚Ä¢ Uke 45</h1>
  <div class="muted">Spis üçé for sp√∏rsm√•l. Svar riktig for √• vokse ‚Äì fungerer p√• mobil og PC!</div>
</header>

<div class="wrap" id="canvasWrap"><canvas id="game" width="720" height="480"></canvas></div>

<!-- Mobil piltaster -->
<div id="mobControls">
  <div class="row"><button id="up">‚¨ÜÔ∏è</button></div>
  <div class="row">
    <button id="left">‚¨ÖÔ∏è</button>
    <button id="down">‚¨áÔ∏è</button>
    <button id="right">‚û°Ô∏è</button>
  </div>
</div>

<!-- Info -->
<div id="ui">
  <span class="chip">Poeng: <b id="score">0</b></span>
  <span class="chip">Liv: <b id="lives">‚ù§‚ù§‚ù§</b></span>
  <span class="chip">Fart: <b id="speedShow">7</b></span>
  <span class="chip">Topp: <b id="best">0</b></span><br>
  <button id="start" class="btn-prim">Start / Restart</button>
  <button id="pause">Pause</button>
  <label class="pill">Fart <input id="speed" type="range" min="4" max="16" value="7"></label>
</div>

<!-- Fasit under -->
<div id="fasitWrap" class="wrap">
  <button id="toggleFasit" class="btn-prim">Vis fasit ‚ñº</button>
  <div id="fasit" style="display:none"></div>
</div>

<!-- Modal -->
<div id="modal">
  <div id="card">
    <p>Skriv engelsk for: <span id="norw" class="good"></span></p>
    <input id="ans" type="text" autocomplete="off" autocapitalize="none" spellcheck="false">
    <div id="hint"></div>
    <div class="row">
      <button id="check" class="btn-prim">Sjekk</button>
      <button id="showHint">Vis fasit</button>
      <button id="skip">Hopp over (‚Äì1 liv)</button>
    </div>
  </div>
</div>

<script>
/* --- Gloser --- */
const PAIRS=[
 {en:"Decent",no:"ordentlig"},
 {en:"Grin",no:"smil"},
 {en:"Terrified",no:"veldig redd"},
 {en:"Wailed",no:"gr√•t"},
 {en:"Yelping",no:"bjeffende"},
 {en:"Leer",no:"sultent blikk"},
 {en:"Furry coat",no:"pelsk√•pe"},
 {en:"Flickers",no:"blunker i rykninger"},
 {en:"Whips out",no:"trekker frem"},
 {en:"Knickers",no:"underbukser"}
];

/* --- Fasit-tabell under spillet --- */
const f=document.getElementById("fasit");
f.innerHTML=`<table><tr><th>Engelsk</th><th>Norsk</th></tr>${PAIRS.map(p=>`<tr><td>${p.en}</td><td>${p.no}</td></tr>`).join("")}</table>`;
document.getElementById("toggleFasit").onclick=(e)=>{
 const open=f.style.display==="none";
 f.style.display=open?"block":"none";
 e.target.textContent=open?"Skjul fasit ‚ñ≤":"Vis fasit ‚ñº";
};

/* --- DOM --- */
const cv=document.getElementById('game'),ctx=cv.getContext('2d');
const ui={score:document.getElementById('score'),lives:document.getElementById('lives'),
  best:document.getElementById('best'),speed:document.getElementById('speed'),
  speedShow:document.getElementById('speedShow'),start:document.getElementById('start'),
  pause:document.getElementById('pause')};
const modal=document.getElementById('modal'),norw=document.getElementById('norw'),
ans=document.getElementById('ans'),checkBtn=document.getElementById('check'),
skipBtn=document.getElementById('skip'),showHint=document.getElementById('showHint'),
hint=document.getElementById('hint');
const LS_KEY="snake45_best";
ui.best.textContent=localStorage.getItem(LS_KEY)||0;

/* --- Canvas --- */
let grid=24,cols=Math.floor(cv.width/grid),rows=Math.floor(cv.height/grid);
function fit(){
  const r=cv.getBoundingClientRect(),ratio=window.devicePixelRatio||1;
  const w=Math.floor(r.width*ratio),h=Math.floor(w*2/3);
  if(cv.width!==w||cv.height!==h){cv.width=w;cv.height=h;cols=Math.floor(w/grid);rows=Math.floor(h/grid);}
}
window.addEventListener('resize',fit);

/* --- Utils --- */
const rand=n=>Math.floor(Math.random()*n);
const norm=s=>s.trim().toLowerCase().replace(/\s+/g," ");
function flash(msg,ok=true,t=900){
  const e=document.createElement('div');e.textContent=msg;
  e.style.position="fixed";e.style.left="50%";e.style.top="12px";e.style.transform="translateX(-50%)";
  e.style.background=ok?"#1f503a":"#5b2230";e.style.color="#fff";
  e.style.padding="10px 14px";e.style.borderRadius="10px";
  e.style.border="1px solid rgba(255,255,255,.15)";e.style.zIndex=99;
  document.body.appendChild(e);setTimeout(()=>e.remove(),t);
}

/* --- Spilltilstand --- */
let snake,dir,nextDir,apple,score,lives,paused=true,loopId=null,lastTick=0,speedMs=1000/7;
let growth=0,current=null,usedHint=false;

/* --- Start/reset --- */
function freeCell(){let x,y;do{x=rand(cols);y=rand(rows);}while(snake.some(s=>s.x===x&&s.y===y));return{x,y};}
function placeApple(){apple=freeCell();}
function reset(){
  fit();snake=[{x:Math.floor(cols/2),y:Math.floor(rows/2)}];
  dir={x:1,y:0};nextDir={x:1,y:0};score=0;lives=3;growth=0;
  ui.score.textContent=score;ui.lives.textContent="‚ù§‚ù§‚ù§";
  placeApple();paused=false;cancelAnimationFrame(loopId);draw();loopId=requestAnimationFrame(tick);
}

/* --- Tegning --- */
function draw(){
  ctx.fillStyle="#0a1020";ctx.fillRect(0,0,cv.width,cv.height);
  ctx.strokeStyle="rgba(34,48,89,.6)";
  for(let i=0;i<=cols;i++){ctx.beginPath();ctx.moveTo(i*grid,0);ctx.lineTo(i*grid,cv.height);ctx.stroke();}
  for(let j=0;j<=rows;j++){ctx.beginPath();ctx.moveTo(0,j*grid);ctx.lineTo(cv.width,j*grid);ctx.stroke();}
  if(apple){ctx.font="bold 14px system-ui";ctx.textAlign="center";ctx.textBaseline="middle";
    ctx.fillText("üçé",apple.x*grid+grid/2,apple.y*grid+grid/2);}
  ctx.fillStyle="#79c8ff";
  snake.forEach((s,i)=>{
    const x=s.x*grid,y=s.y*grid;
    ctx.fillRect(x+2,y+2,grid-4,grid-4);
    if(i===0){ctx.fillStyle="#0b1020";ctx.fillRect(x+6,y+8,3,3);
      ctx.fillRect(x+grid-9,y+8,3,3);ctx.fillStyle="#79c8ff";}
  });
}

/* --- Spill-loop --- */
function tick(ts){
  fit();
  if(paused){draw();loopId=requestAnimationFrame(tick);return;}
  if(ts-lastTick<speedMs){loopId=requestAnimationFrame(tick);return;}
  lastTick=ts;
  if(nextDir.x!==-dir.x||nextDir.y!==-dir.y)dir=nextDir;
  const head={...snake[0]};head.x+=dir.x;head.y+=dir.y;
  if(head.x<0)head.x=cols-1;else if(head.x>=cols)head.x=0;
  if(head.y<0)head.y=rows-1;else if(head.y>=rows)head.y=0;
  if(snake.some(p=>p.x===head.x&&p.y===head.y)){loseLife("Halen");return loopId=requestAnimationFrame(tick);}
  snake.unshift(head);
  if(apple&&head.x===apple.x&&head.y===apple.y){paused=true;askQuestion();}
  else{if(growth>0)growth--;else snake.pop();}
  draw();loopId=requestAnimationFrame(tick);
}

/* --- Sp√∏rsm√•l --- */
function pick(){return PAIRS[rand(PAIRS.length)];}
function askQuestion(){
  current=pick();usedHint=false;
  norw.textContent=current.no;ans.value="";hint.style.display="none";
  modal.style.display="flex";ans.focus();
}
function handleAnswer(ok){
  modal.style.display="none";
  const pts=usedHint?5:10;
  if(ok){score+=pts;ui.score.textContent=score;growth+=2;
    speedMs=Math.max(1000/16,speedMs*0.985);
    flash(ok?`Riktig +${pts}`:"",true);}
  else loseLife("Feil svar");
  placeApple();paused=false;
}
function check(){if(!current)return;handleAnswer(norm(ans.value)===norm(current.en));}
checkBtn.onclick=check;
ans.addEventListener("keydown",e=>{if(e.key==="Enter")check();});
skipBtn.onclick=()=>{modal.style.display="none";loseLife("Hoppet over");placeApple();paused=false;};
showHint.onclick=()=>{
  usedHint=true;
  hint.style.display="block";
  hint.textContent=`Fasit: ${current.en} (halv poeng)`;
};

/* --- Liv --- */
function loseLife(r){
  lives--;
  ui.lives.textContent="‚ù§".repeat(Math.max(lives,0));
  flash(`${r}! ‚Äì 1 liv`,false,1000);
  if(lives<=0)return gameOver();
  snake=[{x:Math.floor(cols/2),y:Math.floor(rows/2)}];
  dir={x:1,y:0};nextDir={x:1,y:0};growth=0;
}
function gameOver(){
  paused=true;
  const best=Number(localStorage.getItem(LS_KEY)||0);
  if(score>best){localStorage.setItem(LS_KEY,String(score));ui.best.textContent=score;}
  flash(`Game over ‚Äì Poeng: ${score}`,false,1600);
}

/* --- Kontroller --- */
function setDir(dx,dy){if(dx===-dir.x&&dy===-dir.y)return;nextDir={x:dx,y:dy};}
window.addEventListener('keydown',e=>{
  const k=e.key.toLowerCase();
  if(["arrowup","w"].includes(k))setDir(0,-1);
  else if(["arrowdown","s"].includes(k))setDir(0,1);
  else if(["arrowleft","a"].includes(k))setDir(-1,0);
  else if(["arrowright","d"].includes(k))setDir(1,0);
});
document.getElementById('up').onclick=()=>setDir(0,-1);
document.getElementById('down').onclick=()=>setDir(0,1);
document.getElementById('left').onclick=()=>setDir(-1,0);
document.getElementById('right').onclick=()=>setDir(1,0);

/* --- UI --- */
ui.start.onclick=()=>{
  speedMs=1000/Number(ui.speed.value);
  ui.speedShow.textContent=ui.speed.value;
  reset();
};
ui.pause.onclick=()=>{
  paused=!paused;
  ui.pause.textContent=paused?"Fortsett":"Pause";
};
ui.speed.addEventListener('input',()=>{
  ui.speedShow.textContent=ui.speed.value;
  speedMs=1000/Number(ui.speed.value);
});

/* --- Start --- */
fit();draw();
</script>
</body>
</html>
